name: Label Client Issues

on:
  issues:
    types: [opened, edited]

permissions:
  issues: write

jobs:
  label:
    runs-on: ubuntu-latest

    steps:
      - name: Check issue body for client type
        id: check_label
        uses: actions/github-script@v7
        with:
          script: |
            const labelsToAdd = [];
            const publicClientOptions = [
              "PublicClient"
            ];
            const confidentialClientOptions = [
              "ConfidentialClient"
            ];
            const managedIdentityClientOptions = [
              "ManagedIdentityClient"
            ];
            
            const issueBody = context.issue.body;
            
            if (publicClientOptions.some(option => issueBody.includes(option))) {
              labelsToAdd.push('public-client');
            }
            
            if (confidentialClientOptions.some(option => issueBody.includes(option))) {
              labelsToAdd.push('confidential-client');
            }

            if (managedIdentityClientOptions.some(option => issueBody.includes(option))) {
              labelsToAdd.push('scenario:ManagedIdentity');
            }

            return labelsToAdd;

      - name: Add labels to the issue
        uses: actions/github-script@v7
        with:
          script: |
            const labels = ${{ steps.check_label.outputs.result }};
            if (labels.length > 0) {
              await github.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                labels: labels
              });
            }